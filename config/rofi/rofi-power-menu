#!/bin/bash

# ripped and stripped from https://github.com/jluttine/rofi-power-menu

all=(shutdown reboot lockscreen logout)
show=("${all[@]}")

declare -A texts
texts[shutdown]="shut down"
texts[reboot]="reboot"
texts[logout]="log out"
texts[lockscreen]="lock screen"

declare -A icons
icons[shutdown]="襤"
icons[reboot]=""
icons[logout]=""
icons[lockscreen]=""

declare -A actions
actions[shutdown]="systemctl poweroff"
actions[reboot]="systemctl reboot"
actions[logout]="loginctl terminate-session ${XDG_SESSION_ID-}"
actions[lockscreen]="slock"

function write_message {
    icon="<span font_size=\"medium\">$1</span>"
    text="<span font_size=\"medium\">$2</span>"
    echo -n "\u200e$icon \u2068$text\u2069"
}

function print_selection {
    echo -e "$1" | $(read -r -d '' entry; echo "echo $entry")
}

declare -A messages
for entry in "${all[@]}"; do
    messages[$entry]=$(write_message "${icons[$entry]}" "${texts[$entry]^}")
done

# Use markup
echo -e "\0markup-rows\x1ftrue"

echo -e "\0prompt\x1f"
for entry in "${show[@]}"; do
	echo -e "${messages[$entry]}\0icon\x1f${icons[$entry]}"
done
